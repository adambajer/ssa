<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Offline režim</title>
  <style>
    body {
      background: #1a1a1a;
      color: white;
      text-align: center;
      font-family: sans-serif;
      padding: 10vh 5vw;
      transition: background 1s ease;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 0.5em;
    }

    .signal-bars {
      display: inline-block;
      margin: 20px auto;
    }

    .bar {
      width: 10px;
      height: 10px;
      margin: 0 3px;
      display: inline-block;
      background-color: #444;
      animation: signalBlink 1s infinite;
    }

    .bar:nth-child(2) { animation-delay: 0.2s; }
    .bar:nth-child(3) { animation-delay: 0.4s; }
    .bar:nth-child(4) { animation-delay: 0.6s; }

    @keyframes signalBlink {
      0%, 100% { opacity: 0.3; transform: scaleY(0.5); }
      50% { opacity: 1; transform: scaleY(1.2); }
    }

    .info {
      margin-top: 20px;
      font-size: 1.1em;
      color: #ccc;
    }

    .online {
      background: #003300;
    }

    .online h1 {
      color: #90ee90;
    }

    .online .bar {
      background-color: limegreen;
      animation: none;
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1 id="status">Offline režim</h1>
  <div class="signal-bars">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
  <div class="info">
    <div>Výpadek začal: <span id="startTime">–</span></div>
    <div>Trvání výpadku: <span id="duration">0 s</span></div>
  </div>

  <script>
    const CHECK_INTERVAL = 1000;
    let reloaded = false;
    const startTimestamp = new Date();
    const startTimeEl = document.getElementById('startTime');
    const durationEl = document.getElementById('duration');
    const statusEl = document.getElementById('status');

    function formatTime(date) {
      return date.toLocaleTimeString('cs-CZ');
    }

    function speak(text) {
      if (!window.speechSynthesis) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'cs-CZ';
      utter.rate = 1;
      window.speechSynthesis.speak(utter);
    }

    function log(msg) {
      console.log(`[${new Date().toLocaleTimeString()}] ${msg}`);
    }

    // inicializace
    startTimeEl.textContent = formatTime(startTimestamp);
    speak('Aplikace je v offline režimu.');
    log('Zahájen offline režim.');

    // aktualizace trvání výpadku
    setInterval(() => {
      const now = new Date();
      const seconds = Math.floor((now - startTimestamp) / 1000);
      durationEl.textContent = `${seconds} s`;
    }, 1000);

    // kontrola připojení
    setInterval(async () => {
      if (reloaded) return;
      try {
        const res = await fetch('/ssa/ping.txt', { cache: 'no-cache' });
        if (res.ok) {
          log('Spojení obnoveno.');
          speak('Připojeno k internetu. Obnovuji aplikaci.');

          // změna stylů a textu
          document.body.classList.add('online');
          statusEl.textContent = 'Připojeno! Obnovuji…';

          reloaded = true;
          setTimeout(() => {
            location.href = '/ssa/';
          }, 1500);
        }
      } catch {
        // pořád offline
      }
    }, CHECK_INTERVAL);
  </script>
</body>
</html>
