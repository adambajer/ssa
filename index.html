<!DOCTYPE html><html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SSA</title>
  <link rel="stylesheet" href="style.css" />  
  <style>
    
  </style>
</head>
<body>
  <div class="wrap">
    <div class="tabs">
      <button class="tab-button" data-tab="user">Vlastn√≠</button>
      <button class="tab-button" data-tab="predefined">P≈ôeddefinovan√©</button>
    </div>
    <div class="tab-content" id="user">
      <div class="panel">
        <div id="rec">
          <button id="start-recording">
                    <svg version="1.1" viewBox="0 0 210 210" xmlns="http://www.w3.org/2000/svg">  
                        <g transform="translate(0 4.174)">  
                            <path  
                                d="m46.2 87.43c-6.23 0-11.28 4.842-11.28 10.82 0 31.98 24.8 58.5 57.06 64.21v26.81h.047a13.02 12.75 0 00-.046.622 13.02 12.75 0 0013.02 12.75 13.02 12.75 0 0013.02-12.75 13.02 12.75 0 00-.016-.622h.016v-26.81c32.27-5.716 57.07-32.23 57.06-64.21 0-5.973-5.05-10.82-11.28-10.82s-11.28 4.842-11.28 10.82c0 24.09-20.95 43.74-47.52 43.74s-47.52-19.65-47.52-43.74c0-5.973-5.05-10.82-11.28-10.82z" />  
                            <ellipse cx="92.74" cy="205.8" rx=".757" ry=".076" />  
                        </g>  
                        <path  
                            d="m105 0c-17.49 0-32.36 10.78-38.38 26.07h52.21c2.77 0 5 1.973 5 4.425 0 2.451-2.23 4.425-5 4.425h-54.61a41.91 41.91 0 00-.482 6.344v.68h55.09c2.77 0 5 1.974 5 4.426 0 2.451-2.23 4.425-5 4.425h-55.09v7.025h55.09c2.77 0 5 1.973 5 4.425 0 2.451-2.23 4.425-5 4.425h-55.09v29.24c0 22.86 18.4 41.26 41.26 41.26s41.26-18.4 41.26-41.26v-54.65c0-22.86-18.4-41.26-41.26-41.26z"  
                            stroke-linecap="round" stroke-miterlimit="4.1" paint-order="markers fill stroke" />  
                        <text transform="rotate(-90)" x="-79.128105" y="25.294184" xml:space="preserve">  
                            <tspan x="-100" y="20" style="font-size:35.28px;stroke-width:.786">ZVUK  
                            </tspan>  
                        </text>  
                    </svg>
          </button>
        </div>
        <div id="rec">
          <button id="start-sound-capture">
            <svg version="1.1" viewBox="0 0 210 210" xmlns="http://www.w3.org/2000/svg">  
                        <g transform="translate(0 4.174)">  
                            <path  
                                d="m46.2 87.43c-6.23 0-11.28 4.842-11.28 10.82 0 31.98 24.8 58.5 57.06 64.21v26.81h.047a13.02 12.75 0 00-.046.622 13.02 12.75 0 0013.02 12.75 13.02 12.75 0 0013.02-12.75 13.02 12.75 0 00-.016-.622h.016v-26.81c32.27-5.716 57.07-32.23 57.06-64.21 0-5.973-5.05-10.82-11.28-10.82s-11.28 4.842-11.28 10.82c0 24.09-20.95 43.74-47.52 43.74s-47.52-19.65-47.52-43.74c0-5.973-5.05-10.82-11.28-10.82z" />  
                            <ellipse cx="92.74" cy="205.8" rx=".757" ry=".076" />  
                        </g>  
                        <path  
                            d="m105 0c-17.49 0-32.36 10.78-38.38 26.07h52.21c2.77 0 5 1.973 5 4.425 0 2.451-2.23 4.425-5 4.425h-54.61a41.91 41.91 0 00-.482 6.344v.68h55.09c2.77 0 5 1.974 5 4.426 0 2.451-2.23 4.425-5 4.425h-55.09v7.025h55.09c2.77 0 5 1.973 5 4.425 0 2.451-2.23 4.425-5 4.425h-55.09v29.24c0 22.86 18.4 41.26 41.26 41.26s41.26-18.4 41.26-41.26v-54.65c0-22.86-18.4-41.26-41.26-41.26z"  
                            stroke-linecap="round" stroke-miterlimit="4.1" paint-order="markers fill stroke" />  
                        <text transform="rotate(-90)" x="-79.128105" y="25.294184" xml:space="preserve">  
                            <tspan x="-100" y="20" style="font-size:35.28px;stroke-width:.786">TEXT  
                            </tspan>  
                        </text>  
                    </svg>
          </button>
        </div>
      </div>
      <div id="user-container"></div>
    </div>
    <div class="tab-content" id="predefined">
      <div id="predefined-container"></div>
    </div>
  </div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tabButtons = document.querySelectorAll(".tab-button");
      const tabContents = document.querySelectorAll(".tab-content");
      const predefinedContainer = document.getElementById("predefined-container");
      const userContainer = document.getElementById("user-container");
      const startRecordingButton = document.getElementById("start-recording");
      const startSoundCaptureButton = document.getElementById("start-sound-capture");

      const shortcuts = "abcdefghijklmnopqrstuvwxyz".split("");
      let isPlaying = false, hasSpoken = false, isRecording = false;
      let mediaRecorder;
      let audioChunks = [];
      let audioStartTime;

      const setActiveTab = (id) => {
        tabButtons.forEach(btn => btn.classList.toggle("active", btn.dataset.tab === id));
        tabContents.forEach(tab => tab.classList.toggle("active", tab.id === id));
        localStorage.setItem("activeTab", id);
      };
      const activeTab = localStorage.getItem("activeTab") || "user";
      setActiveTab(activeTab);
      tabButtons.forEach(btn => btn.addEventListener("click", () => setActiveTab(btn.dataset.tab)));

      const readTextAloud = (text, callback) => {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'cs-CZ';
        utter.onend = callback;
        speechSynthesis.speak(utter);
      };

      const createTranscriptionButton = (text, container = userContainer, isPredefined = false) => {
        const wrapper = document.createElement("div");
        wrapper.className = "transcription-button";

        const button = document.createElement("button");
        button.className = "text-button";
        button.textContent = text;

        const shortcut = shortcuts.shift();
        if (shortcut) {
          const span = document.createElement("span");
          span.className = "shortcut";
          span.textContent = shortcut.toUpperCase();
          button.appendChild(span);

          document.addEventListener("keydown", e => {
            if (e.key === shortcut) {
              button.click();
              wrapper.classList.toggle('active');
            }
          });
        }

        button.addEventListener("click", () => {
          if (!isPlaying && !hasSpoken) {
            isPlaying = true;
            hasSpoken = true;
            readTextAloud(text, () => {
              isPlaying = false;
              hasSpoken = false;
            });
          }
        });

        const editBtn = document.createElement("button");
        editBtn.className = "edit-button";
        editBtn.innerHTML = "‚úèÔ∏è";
        editBtn.addEventListener("click", () => {
          const newText = prompt("Upravit text:", text);
          if (newText) {
            button.textContent = newText;
            if (!isPredefined) updateTranscription(text, newText);
          }
        });

        const delBtn = document.createElement("button");
        delBtn.className = "delete-button";
        delBtn.innerHTML = "üóëÔ∏è";
        delBtn.addEventListener("click", () => {
          wrapper.remove();
          if (!isPredefined) deleteTranscription(text);
        });

        wrapper.appendChild(delBtn);
        wrapper.appendChild(button);
        wrapper.appendChild(editBtn);
        container.appendChild(wrapper);
      };

      const saveTranscription = (text) => {
        const stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored.push(text);
        localStorage.setItem("transcriptions", JSON.stringify(stored));
      };

      const updateTranscription = (oldText, newText) => {
        let stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        const index = stored.indexOf(oldText);
        if (index !== -1) {
          stored[index] = newText;
          localStorage.setItem("transcriptions", JSON.stringify(stored));
        }
      };

      const deleteTranscription = (text) => {
        let stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored = stored.filter(t => t !== text);
        localStorage.setItem("transcriptions", JSON.stringify(stored));
      };

      const loadTranscriptions = () => {
        const stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored.forEach(text => createTranscriptionButton(text, userContainer));
      };

      const predefined = ["√öplnƒõ c√≠t√≠m jak ti v n√≠ cuk√°", "Je≈æi≈°i", "Poƒçkej"];
      predefined.forEach(t => createTranscriptionButton(t, predefinedContainer, true));
      loadTranscriptions();

      if (annyang) {
        const commands = {
          '*text': text => {
            createTranscriptionButton(text, userContainer);
            saveTranscription(text);
          }
        };
        annyang.addCommands(commands);
        annyang.setLanguage('cs-CZ');

        const toggleRecording = () => {
          if (isRecording) {
            annyang.abort();
            startRecordingButton.classList.remove('active');
          } else {
            annyang.start();
            startRecordingButton.classList.add('active');
          }
          isRecording = !isRecording;
        };

        startRecordingButton.addEventListener("click", toggleRecording);
        document.addEventListener("keydown", e => {
          if (e.key === "Control") toggleRecording();
        });

        annyang.addCallback('end', () => {
          if (isRecording) toggleRecording();
        });
      }

      startSoundCaptureButton.addEventListener("click", () => {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          startSoundCaptureButton.classList.remove("active");
        } else {
          navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];
            audioStartTime = Date.now();

            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop = () => {
              const blob = new Blob(audioChunks, { type: 'audio/wav' });
              const url = URL.createObjectURL(blob);
              const duration = (Date.now() - audioStartTime) / 1000;

              const wrapper = document.createElement("div");
              wrapper.className = "transcription-button";

              const playBtn = document.createElement("button");
              playBtn.className = "edit-button";
              playBtn.textContent = "‚ñ∂Ô∏è";
              playBtn.onclick = () => new Audio(url).play();

              const label = document.createElement("button");
              label.className = "text-button";
              label.textContent = `Raw Audio (${duration.toFixed(1)}s)`;

              const del = document.createElement("button");
              del.className = "delete-button";
              del.textContent = "üóëÔ∏è";
              del.onclick = () => wrapper.remove();

              wrapper.appendChild(del);
              wrapper.appendChild(label);
              wrapper.appendChild(playBtn);
              userContainer.appendChild(wrapper);
            };

            mediaRecorder.start();
            startSoundCaptureButton.classList.add("active");
          });
        }
      });
    });
  </script>
</body>
</html>
