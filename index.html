<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SSA</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .wrap {
      padding: 20px;
      font-family: sans-serif;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .tab-button {
      padding: 8px 16px;
      cursor: pointer;
      border: none;
      background: #eee;
      border-radius: 5px;
    }

    .tab-button.active {
      background: #ccc;
      font-weight: bold;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .transcription-button {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .text-button {
      padding: 6px 12px;
      background: #f0f0f0;
      border: none;
      border-radius: 4px;
      flex-grow: 1;
      text-align: left;
    }

    .edit-button, .delete-button {
      cursor: pointer;
      background: transparent;
      border: none;
      font-size: 18px;
    }

    .shortcut {
      margin-left: 10px;
      color: gray;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="tabs">
      <button class="tab-button active" data-tab="predefined">P≈ôeddefinovan√©</button>
      <button class="tab-button" data-tab="user">Vlastn√≠</button>
    </div>

    <div class="tab-content active" id="predefined"></div>
    <div class="tab-content" id="user"></div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const predefinedContainer = document.getElementById("predefined");
      const userContainer = document.getElementById("user");
      const shortcuts = "abcdefghijklmnopqrstuvwxyz".split("");
      let isPlaying = false;
      let hasSpoken = false;

      // TAB SWITCHING
      document.querySelectorAll(".tab-button").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
          document.querySelectorAll(".tab-content").forEach(tc => tc.classList.remove("active"));

          btn.classList.add("active");
          document.getElementById(btn.dataset.tab).classList.add("active");
        });
      });

      // SPEAK TEXT
      const readTextAloud = (text, callback) => {
        const utterThis = new SpeechSynthesisUtterance(text);
        utterThis.lang = 'cs-CZ';
        utterThis.onend = callback;
        window.speechSynthesis.speak(utterThis);
      };

      // CREATE BUTTON
      const createTranscriptionButton = (text, container = userContainer, isPredefined = false) => {
        const buttonWrapper = document.createElement("div");
        buttonWrapper.className = "transcription-button";

        const button = document.createElement("button");
        button.className = "text-button";
        button.textContent = text;

        const shortcut = shortcuts.shift();
        if (shortcut) {
          const shortcutSpan = document.createElement("span");
          shortcutSpan.className = "shortcut";
          shortcutSpan.textContent = shortcut.toUpperCase();
          button.appendChild(shortcutSpan);

          document.addEventListener("keydown", (event) => {
            if (event.key === shortcut) {
              button.click();
              buttonWrapper.classList.toggle('active');
            }
          });
        }

        button.addEventListener("click", () => {
          if (!isPlaying && !hasSpoken) {
            isPlaying = true;
            hasSpoken = true;
            readTextAloud(text, () => {
              isPlaying = false;
              hasSpoken = false;
            });
          }
        });

        const editButton = document.createElement("button");
        editButton.className = "edit-button";
        editButton.innerHTML = "‚úèÔ∏è";
        editButton.addEventListener("click", () => {
          const newText = prompt("Upravit text:", text);
          if (newText) {
            button.textContent = newText;
            if (!isPredefined) updateTranscription(text, newText);
          }
        });

        const deleteButton = document.createElement("button");
        deleteButton.className = "delete-button";
        deleteButton.innerHTML = "üóëÔ∏è";
        deleteButton.addEventListener("click", () => {
          buttonWrapper.remove();
          if (!isPredefined) deleteTranscription(text);
        });

        buttonWrapper.appendChild(deleteButton);
        buttonWrapper.appendChild(button);
        buttonWrapper.appendChild(editButton);
        container.appendChild(buttonWrapper);
      };

      // LOCAL STORAGE LOGIC
      const saveTranscription = (text) => {
        let stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored.push(text);
        localStorage.setItem("transcriptions", JSON.stringify(stored));
      };

      const updateTranscription = (oldText, newText) => {
        let stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        const index = stored.indexOf(oldText);
        if (index !== -1) {
          stored[index] = newText;
          localStorage.setItem("transcriptions", JSON.stringify(stored));
        }
      };

      const deleteTranscription = (text) => {
        let stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored = stored.filter(t => t !== text);
        localStorage.setItem("transcriptions", JSON.stringify(stored));
      };

      const loadTranscriptions = () => {
        const stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored.forEach(text => createTranscriptionButton(text, userContainer));
      };

      const predefined = [
        "Dobr√Ω den",
        "Jak v√°m mohu pomoci?",
        "Pros√≠m, ≈ôeknƒõte nƒõco.",
        "Dƒõkuji, nashledanou.",
        "Zkuste to znovu."
      ];

      predefined.forEach(text => createTranscriptionButton(text, predefinedContainer, true));
      loadTranscriptions();
    });
  </script>
</body>

</html>
