<!DOCTYPE html><html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SSA</title>
  <style>
    .wrap {
      padding: 20px;
      font-family: sans-serif;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .tab-button {
      padding: 8px 16px;
      cursor: pointer;
      border: none;
      background: #eee;
      border-radius: 5px;
    }
    .tab-button.active {
      background: #ccc;
      font-weight: bold;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .panel {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    #rec button {
      background: none;
      border: none;
      cursor: pointer;
      width: 80px;
      height: 80px;
    }
    .transcription-button {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .text-button {
      padding: 6px 12px;
      background: #f0f0f0;
      border: none;
      border-radius: 4px;
      flex-grow: 1;
      text-align: left;
    }
    .edit-button, .delete-button {
      cursor: pointer;
      background: transparent;
      border: none;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="tabs">
      <button class="tab-button" data-tab="user">Vlastn√≠</button>
      <button class="tab-button" data-tab="predefined">P≈ôeddefinovan√©</button>
    </div><div class="tab-content" id="user">
  <div class="panel">
    <div id="rec">
      <button id="start-recording">
        <!-- SVG TEXT -->
        <svg viewBox="0 0 210 210" xmlns="http://www.w3.org/2000/svg">
          <text transform="rotate(-90)" x="-100" y="20" style="font-size:35.28px;stroke-width:.786">TEXT</text>
        </svg>
      </button>
    </div>
    <div id="rec">
      <button id="start-sound-capture">
        <!-- SVG RAW -->
        <svg viewBox="0 0 210 210" xmlns="http://www.w3.org/2000/svg">
          <text transform="rotate(-90)" x="-100" y="20" style="font-size:35.28px;stroke-width:.786">RAW</text>
        </svg>
      </button>
    </div>
  </div>
  <div id="user-container"></div>
</div>

<div class="tab-content" id="predefined">
  <div id="predefined-container"></div>
</div>

  </div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tabButtons = document.querySelectorAll(".tab-button");
      const tabContents = document.querySelectorAll(".tab-content");
      const predefinedContainer = document.getElementById("predefined-container");
      const userContainer = document.getElementById("user-container");
      const startRecordingButton = document.getElementById("start-recording");
      const startSoundCaptureButton = document.getElementById("start-sound-capture");
      const shortcuts = "abcdefghijklmnopqrstuvwxyz".split("");

      let isPlaying = false;
      let hasSpoken = false;
      let isRecording = false;
      let mediaRecorder;
      let audioChunks = [];
      let audioStartTime;

      const setActiveTab = (id) => {
        tabButtons.forEach(btn => btn.classList.toggle("active", btn.dataset.tab === id));
        tabContents.forEach(tab => tab.classList.toggle("active", tab.id === id));
        localStorage.setItem("activeTab", id);
      };

      let activeTab = localStorage.getItem("activeTab") || "user";
      setActiveTab(activeTab);

      tabButtons.forEach(btn => {
        btn.addEventListener("click", () => setActiveTab(btn.dataset.tab));
      });

      const readTextAloud = (text, callback) => {
        const utterThis = new SpeechSynthesisUtterance(text);
        utterThis.lang = 'cs-CZ';
        utterThis.onend = callback;
        window.speechSynthesis.speak(utterThis);
      };

      const createTranscriptionButton = (text, container = userContainer, isPredefined = false) => {
        const wrapper = document.createElement("div");
        wrapper.className = "transcription-button";

        const button = document.createElement("button");
        button.className = "text-button";
        button.textContent = text;

        const shortcut = shortcuts.shift();
        if (shortcut) {
          const span = document.createElement("span");
          span.className = "shortcut";
          span.textContent = shortcut.toUpperCase();
          button.appendChild(span);

          document.addEventListener("keydown", e => {
            if (e.key === shortcut) {
              button.click();
              wrapper.classList.toggle('active');
            }
          });
        }

        button.addEventListener("click", () => {
          if (!isPlaying && !hasSpoken) {
            isPlaying = true;
            hasSpoken = true;
            readTextAloud(text, () => {
              isPlaying = false;
              hasSpoken = false;
            });
          }
        });

        const editBtn = document.createElement("button");
        editBtn.className = "edit-button";
        editBtn.innerHTML = "‚úèÔ∏è";
        editBtn.addEventListener("click", () => {
          const newText = prompt("Upravit text:", text);
          if (newText) {
            button.textContent = newText;
            if (!isPredefined) updateTranscription(text, newText);
          }
        });

        const delBtn = document.createElement("button");
        delBtn.className = "delete-button";
        delBtn.innerHTML = "üóëÔ∏è";
        delBtn.addEventListener("click", () => {
          wrapper.remove();
          if (!isPredefined) deleteTranscription(text);
        });

        wrapper.appendChild(delBtn);
        wrapper.appendChild(button);
        wrapper.appendChild(editBtn);
        container.appendChild(wrapper);
      };

      const saveTranscription = (text) => {
        const stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored.push(text);
        localStorage.setItem("transcriptions", JSON.stringify(stored));
      };

      const updateTranscription = (oldText, newText) => {
        let stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        const index = stored.indexOf(oldText);
        if (index !== -1) {
          stored[index] = newText;
          localStorage.setItem("transcriptions", JSON.stringify(stored));
        }
      };

      const deleteTranscription = (text) => {
        let stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored = stored.filter(t => t !== text);
        localStorage.setItem("transcriptions", JSON.stringify(stored));
      };

      const loadTranscriptions = () => {
        const stored = JSON.parse(localStorage.getItem("transcriptions")) || [];
        stored.forEach(text => createTranscriptionButton(text, userContainer));
      };

      const predefined = ["Dobr√Ω den", "Jak v√°m mohu pomoci?", "Zkuste to znovu."];
      predefined.forEach(t => createTranscriptionButton(t, predefinedContainer, true));
      loadTranscriptions();

      if (annyang) {
        const commands = {
          '*text': text => {
            createTranscriptionButton(text, userContainer);
            saveTranscription(text);
          }
        };
        annyang.addCommands(commands);
        annyang.setLanguage('cs-CZ');

        const toggleRecording = () => {
          if (isRecording) {
            annyang.abort();
            startRecordingButton.classList.remove('active');
          } else {
            annyang.start();
            startRecordingButton.classList.add('active');
          }
          isRecording = !isRecording;
        };

        startRecordingButton.addEventListener("click", toggleRecording);
        document.addEventListener("keydown", e => {
          if (e.key === "Control") toggleRecording();
        });

        annyang.addCallback('end', () => {
          if (isRecording) toggleRecording();
        });
      }

      startSoundCaptureButton.addEventListener("click", () => {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          startSoundCaptureButton.classList.remove("active");
        } else {
          navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];
            audioStartTime = Date.now();

            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop = () => {
              const blob = new Blob(audioChunks, { type: 'audio/wav' });
              const url = URL.createObjectURL(blob);
              const duration = (Date.now() - audioStartTime) / 1000;

              const wrapper = document.createElement("div");
              wrapper.className = "transcription-button";

              const playBtn = document.createElement("button");
              playBtn.className = "edit-button";
              playBtn.textContent = "‚ñ∂Ô∏è";
              playBtn.onclick = () => new Audio(url).play();

              const label = document.createElement("button");
              label.className = "text-button";
              label.textContent = `Raw Audio (${duration.toFixed(1)}s)`;

              const del = document.createElement("button");
              del.className = "delete-button";
              del.textContent = "üóëÔ∏è";
              del.onclick = () => wrapper.remove();

              wrapper.appendChild(del);
              wrapper.appendChild(label);
              wrapper.appendChild(playBtn);
              userContainer.appendChild(wrapper);
            };

            mediaRecorder.start();
            startSoundCaptureButton.classList.add("active");
          });
        }
      });
    });
  </script></body>
</html>
